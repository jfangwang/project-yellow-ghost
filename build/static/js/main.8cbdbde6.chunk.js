(this["webpackJsonpproject-yellow-ghost"]=this["webpackJsonpproject-yellow-ghost"]||[]).push([[0],{100:function(e,t,s){},101:function(e,t,s){"use strict";s.r(t);var i=s(4),c=s.n(i),n=s(44),a=s.n(n),o=s(14),l=s(15),r=s(18),d=s(17),u=s(38),m=s(25),h=s.n(m),j=s(26),g=(s(93),s(10)),b=(s(94),s(103),s(96),s(104),s(102),s(105),g.a.initializeApp({apiKey:"AIzaSyAzNigqy7stltnVUU8cAollxCxvW0CNBTE",authDomain:"ghost-f8b34.firebaseapp.com",projectId:"ghost-f8b34",storageBucket:"ghost-f8b34.appspot.com",messagingSenderId:"838623299070",appId:"1:838623299070:web:b73429fee525b7c01cacaf",measurementId:"G-85ZG5FVKQ4"}).firestore()),p=g.a.auth(),f=g.a.storage(),O=new g.a.auth.GoogleAuthProvider,v=(s(37),s(2));function x(e){return Object(v.jsx)(v.Fragment,{children:Object(v.jsxs)("div",{className:"navbar",children:[Object(v.jsx)("div",{className:"nav-box-1",children:Object(v.jsxs)("ul",{children:[Object(v.jsx)("li",{children:"Guest"==e.user_name?Object(v.jsx)("a",{onClick:e.login,children:"Sign In"}):Object(v.jsx)("img",{class:"profile-pic",src:e.user_pic,onClick:e.logout,alt:"Profile Picture"})}),Object(v.jsx)("li",{children:Object(v.jsx)("a",{children:"Search"})})]})}),Object(v.jsx)("div",{className:"nav-box-2",children:Object(v.jsx)("h1",{children:"Chat"})}),Object(v.jsx)("div",{className:"nav-box-3",children:Object(v.jsxs)("ul",{children:[Object(v.jsx)("li",{children:Object(v.jsx)("a",{children:"Add Friend"})}),Object(v.jsx)("li",{children:Object(v.jsx)("a",{children:"New Chat"})})]})})]})})}var w=s(11),_=s(48);function S(e){var t=Object(i.useState)("Received"),s=Object(w.a)(t,2),c=s[0],n=s[1],a=Object(i.useState)(0),o=Object(w.a)(a,2),l=o[0],r=o[1],d=Object(i.useState)([]),u=Object(w.a)(d,2),m=(u[0],u[1],function(){b.collection("posts").doc(e.user_email).collection("Received").orderBy("timeStamp","desc").onSnapshot((function(t){for(var s=0;s<t.docs.length&&t.docs[s].data().email!=e.sender_email;)s+=1;s<t.docs.length&&t.docs[s].data().email==e.sender_email?(n("New Snap"),null!=t.docs[s].data().timeStamp&&r(t.docs[s].data().timeStamp.toDate().toUTCString())):n("Received")}))}),h=Object(v.jsx)("p",{children:c}),j=Object(v.jsx)("div",{className:"message-received"});"New Snap"===c?(j=Object(v.jsx)("div",{className:"message-new"}),h=Object(v.jsx)("p",{className:"red",children:Object(v.jsx)("b",{children:c})})):"Received"===c?j=Object(v.jsx)("div",{className:"message-received"}):"Sent"===c?j=Object(v.jsx)("div",{className:"message-sent"}):"Opened"===c&&(j=Object(v.jsx)("div",{className:"message-opened"}));var g=Object(i.useState)(null),p=Object(w.a)(g,2),O=p[0],x=p[1],S=Object(i.useState)(null),k=Object(w.a)(S,2),N=k[0],C=k[1],y=Object(i.useState)("https://upload.wikimedia.org/wikipedia/commons/thumb/7/7e/Circle-icons-profile.svg/2048px-Circle-icons-profile.svg.png"),R=Object(w.a)(y,2),U=R[0],G=R[1],E=Object(i.useState)("Guest (Me)"),L=Object(w.a)(E,2),I=L[0],D=L[1];return Object(i.useEffect)((function(){m(),b.collection("users").doc(e.sender_email).get().then((function(e){e.exists?(G(e.data().photoURL),D(e.data().name)):(G("https://upload.wikimedia.org/wikipedia/commons/thumb/7/7e/Circle-icons-profile.svg/2048px-Circle-icons-profile.svg.png"),D("Guest (Me)"))}))})),Object(v.jsx)(v.Fragment,{children:O?Object(v.jsx)("div",{className:"image-background",onClick:function(){x(null),console.log("opening snap",e.user_email),b.collection("posts").doc(e.user_email).collection("Received").doc(N).delete().then((function(){console.log("Document deleted")})).catch((function(e){console.log("Error removing document: ",e)})),m();var t=b.collection("posts").doc(e.sender_email).collection("Sent").doc(N);t.get().then((function(s){if(1==s.data().to.length)t.delete().then((function(){console.log("sender document deleted, everyone saw the pic")})).catch((function(e){console.log("Could not delete sender's document")})),f.ref("posts/".concat(N)).delete().then((function(e){console.log("Deleted from storage: ",N)})).catch((function(e){console.log("TRIED DELETING: ",N)})),b.collection("posts").doc(N).delete().then((function(){console.log("Deleted from firestore")})).catch((function(e){console.error("Error removing document: ",e)}));else{var i=0,c=[];for(i=0;i<s.data().to.length;i+=1)s.data().to[i]!=e.user_email&&(c[i]=s.data().to[i]);t.update({to:c}).then((function(){console.log("Updated sender's list")})).catch((function(e){console.log("could not update list: ",e)}))}}))},children:Object(v.jsx)("img",{className:"image",src:O})}):Object(v.jsxs)("li",{className:"message-content",onClick:function(){console.log("opening snap",e.user_email),b.collection("posts").doc(e.user_email).collection("Received").orderBy("timeStamp","desc").get().then((function(t){for(var s=0;s<t.docs.length&&t.docs[s].data().email!=e.sender_email;)s+=1;s<t.docs.length&&t.docs[s].data().email==e.sender_email?null!=t.docs[s].data()&&(x(t.docs[s].data().imageURL),C(t.docs[s].data().id)):n("Received")}))},children:[Object(v.jsx)("img",{className:"message-avatar",src:U,alt:"Avatar"}),Object(v.jsxs)("ul",{className:"message-info",children:[Object(v.jsx)("h3",{children:I}),Object(v.jsxs)("div",{className:"message-sub-info",children:[j,h,Object(v.jsx)("p",{children:Object(v.jsx)(_.a,{date:l,locale:"en-US"})}),e.streak_num>0?Object(v.jsxs)("p",{children:[e.streak_num,e.streak_image]}):null]})]})]})})}Object(j.bindKeyboard)(h.a);var k=function(e){Object(r.a)(s,e);var t=Object(d.a)(s);function s(e){var i;return Object(o.a)(this,s),(i=t.call(this,e)).login=function(){p.signInWithPopup(O).then((function(e){i.setState({user_name:e.user.displayName,user_email:e.user.email,user_pic:e.user.photoURL}),b.collection("users").doc(e.user.email).get().then((function(t){t.exists?i.get_friends_list():b.collection("users").doc(e.user.email).set({email:e.user.email,name:e.user.displayName,photoURL:e.user.photoURL,streak_emoji:i.state.streak_image,friends:[e.user.email]},i.get_friends_list()).catch((function(e){console.log("Couldn't write user to DB, error: ",e)}))})).catch((function(e){console.log("Error getting document:",e)}))})).catch((function(e){return console.log(e.message)}))},i.logout=function(){g.a.auth().signOut(),i.setState({user_name:"Guest",user_email:"Guest",user_friends:["Guest (Me)"],user_pic:"https://upload.wikimedia.org/wikipedia/commons/thumb/7/7e/Circle-icons-profile.svg/2048px-Circle-icons-profile.svg.png"})},i.get_friends_list=function(){b.collection("users").doc(i.state.user_email).get().then((function(e){i.setState({user_friends:e.data().friends})}))},i.state={streak_image:"\ud83d\udd25",user_name:"Guest",user_email:"Guest",user_friends:["Guest (Me)"],user_pic:"https://upload.wikimedia.org/wikipedia/commons/thumb/7/7e/Circle-icons-profile.svg/2048px-Circle-icons-profile.svg.png"},i}return Object(l.a)(s,[{key:"render",value:function(){var e=this,t=this.state.user_friends,s=0,i=[];for(s=0;s<t.length;s+=1)i[s]=t[s];return Object(v.jsxs)("div",{className:"messages-screen",children:[Object(v.jsx)(x,{user_name:this.state.user_name,user_pic:this.state.user_pic,login:this.login,logout:this.logout}),Object(v.jsx)("ul",{className:"messages-list",children:i.map((function(t){return Object(v.jsx)(S,{sender_email:t,user_email:e.state.user_email,streak_image:e.state.streak_image})}))})]})}}]),s}(i.Component),N=s(47),C=s.n(N),y=s(108),R=(s(100),function(e){Object(r.a)(s,e);var t=Object(d.a)(s);function s(e){var i;return Object(o.a)(this,s),(i=t.call(this,e)).update=function(){i.setState({width:window.innerWidth,height:window.innerHeight,faceMode:"user"})},i.send=function(){var e=g.a.auth().currentUser,t=Object(y.a)(),s=e.email,c=e.displayName,n=[s];f.ref("posts/".concat(t)).putString(i.state.image,"data_url").on("state_changed",(function(e){}),(function(e){console.log(e)}),(function(){var e=0;for(e=0;e<n.length;e++){console.log(typeof n[e],n[e]);var a=n[e];f.ref("posts").child(t).getDownloadURL().then((function(e){b.collection("posts").doc(a).collection("Received").doc(t).set({imageURL:e,id:t,email:s,name:c,avatarURL:"https://upload.wikimedia.org/wikipedia/commons/thumb/7/7e/Circle-icons-profile.svg/2048px-Circle-icons-profile.svg.png",read:!1,timeStamp:g.a.firestore.FieldValue.serverTimestamp(),to:n}),console.log("Photo Sent"),i.setState({image:null,screen:"camera"})}))}b.collection("posts").doc(s).collection("Sent").doc(t).set({id:t,email:s,timeStamp:g.a.firestore.FieldValue.serverTimestamp(),to:n})}))},i.close=function(){i.setState({image:null,screen:"camera"})},i.send_to=function(){i.setState({screen:"send_to"})},i.capture=function(){var e=i.webcam.getScreenshot();i.setState({image:e,screen:"captured"})},i.setRef=function(e){i.webcam=e},i.state={width:window.innerWidth,height:window.innerHeight,image:null,screen:"camera"},window.addEventListener("resize",i.update),i}return Object(l.a)(s,[{key:"render",value:function(){return Object(v.jsxs)(v.Fragment,{children:["camera"==this.state.screen?Object(v.jsxs)("div",{className:"cam-tab",children:[Object(v.jsx)(C.a,{ref:this.setRef,videoConstraints:{facingMode:this.state.faceMode,width:this.state.width,height:this.state.height},screenshotFormat:"image/jpeg",audio:!1,mirrored:!0,className:"webcam"}),Object(v.jsx)("button",{className:"capture",onClick:this.capture,children:"Capture"})]}):null,"captured"==this.state.screen&&this.state.image?Object(v.jsxs)("div",{className:"cam-tab",children:[Object(v.jsx)("img",{src:this.state.image}),Object(v.jsx)("button",{className:"capture",onClick:this.send_to,children:"Send to"}),Object(v.jsx)("button",{className:"send",onClick:this.close,children:"Close"})]}):null,"send_to"==this.state.screen&&this.state.image?Object(v.jsxs)("div",{className:"user-list",children:[Object(v.jsx)("button",{className:"send",onClick:this.send,children:"Send"}),Object(v.jsx)("button",{className:"capture",onClick:this.close,children:"Close"})]}):null]})}}]),s}(i.Component)),U=Object(j.bindKeyboard)(h.a),G=function(e){Object(r.a)(s,e);var t=Object(d.a)(s);function s(e){var i;return Object(o.a)(this,s),(i=t.call(this,e)).update=function(){i.setState({width:window.innerWidth,height:window.innerHeight})},i.state={index:0,height:window.innerHeight,width:window.innerWidth},window.addEventListener("resize",i.update),i}return Object(l.a)(s,[{key:"render",value:function(){return Object(v.jsxs)(U,{enableMouseEvents:!0,style:Object.assign({width:this.state.width,height:this.state.height,position:"absolute",top:"0%",left:"0%"}),children:[Object(v.jsxs)("div",{style:Object.assign({backgroundColor:"mediumseagreen",height:"100%",width:"100%"}),children:[Object(v.jsx)(u.a,{children:Object(v.jsx)("meta",{name:"viewport",content:"height=device-height, width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"})}),Object(v.jsx)(k,{})]}),Object(v.jsxs)("div",{style:Object.assign({backgroundColor:"Plum"}),children:[Object(v.jsx)(u.a,{children:Object(v.jsx)("meta",{name:"viewport",content:"height=device-height, width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes"})}),Object(v.jsx)(R,{})]})]})}}]),s}(c.a.Component);a.a.render(Object(v.jsx)(G,{}),document.getElementById("root"))},37:function(e,t,s){},93:function(e,t,s){}},[[101,1,2]]]);
//# sourceMappingURL=main.8cbdbde6.chunk.js.map