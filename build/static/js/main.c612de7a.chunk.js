(this["webpackJsonpproject-yellow-ghost"]=this["webpackJsonpproject-yellow-ghost"]||[]).push([[0],{100:function(e,t,s){},101:function(e,t,s){"use strict";s.r(t);var i=s(4),n=s.n(i),c=s(43),a=s.n(c),o=s(12),l=s(13),r=s(15),d=s(14),u=s(37),m=s(46),h=s.n(m),g=s(36),j=(s(93),s(10)),p=(s(94),s(103),s(96),s(104),s(102),s(105),j.a.initializeApp({apiKey:"AIzaSyAzNigqy7stltnVUU8cAollxCxvW0CNBTE",authDomain:"ghost-f8b34.firebaseapp.com",projectId:"ghost-f8b34",storageBucket:"ghost-f8b34.appspot.com",messagingSenderId:"838623299070",appId:"1:838623299070:web:b73429fee525b7c01cacaf",measurementId:"G-85ZG5FVKQ4"}).firestore()),b=j.a.auth(),f=j.a.storage(),O=new j.a.auth.GoogleAuthProvider,v=(s(35),s(2)),x=(i.Component,s(11)),w=s(48);function _(e){var t=Object(i.useState)("Received"),s=Object(x.a)(t,2),n=s[0],c=s[1],a=Object(i.useState)(0),o=Object(x.a)(a,2),l=o[0],r=o[1],d=Object(i.useState)([]),u=Object(x.a)(d,2),m=(u[0],u[1],function(){p.collection("posts").doc(e.user_email).collection("Received").orderBy("timeStamp","desc").onSnapshot((function(e){if(e.docs.length>0){if(c("New Snap"),null!=e.docs[0].data())try{console.log(e.docs[0].data().timeStamp.toDate().toUTCString()),r(e.docs[0].data().timeStamp.toDate().toUTCString())}catch(t){console.log("error")}}else c("Received")}))}),h=Object(v.jsx)("p",{children:n}),g=Object(v.jsx)("div",{className:"message-received"});"New Snap"===n?(g=Object(v.jsx)("div",{className:"message-new"}),h=Object(v.jsx)("p",{className:"red",children:Object(v.jsx)("b",{children:n})})):"Received"===n?g=Object(v.jsx)("div",{className:"message-received"}):"Sent"===n?g=Object(v.jsx)("div",{className:"message-sent"}):"Opened"===n&&(g=Object(v.jsx)("div",{className:"message-opened"}));var j=Object(i.useState)(null),b=Object(x.a)(j,2),O=b[0],_=b[1],S=Object(i.useState)(null),k=Object(x.a)(S,2),C=k[0],N=k[1],y=Object(i.useState)("https://upload.wikimedia.org/wikipedia/commons/thumb/7/7e/Circle-icons-profile.svg/2048px-Circle-icons-profile.svg.png"),R=Object(x.a)(y,2),U=R[0],E=R[1],G=Object(i.useState)("Guest (Me)"),L=Object(x.a)(G,2),D=L[0],I=L[1];return Object(i.useEffect)((function(){m(),p.collection("users").doc(e.sender_email).get().then((function(e){e.exists?(E(e.data().photoURL),I(e.data().name)):(E("https://upload.wikimedia.org/wikipedia/commons/thumb/7/7e/Circle-icons-profile.svg/2048px-Circle-icons-profile.svg.png"),I("Guest (Me)"))}))})),Object(v.jsx)(v.Fragment,{children:O?Object(v.jsx)("div",{className:"image-background",onClick:function(){_(null),console.log("opening snap",e.user_email),p.collection("posts").doc(e.user_email).collection("Received").doc(C).delete().then((function(){console.log("Document deleted")})).catch((function(e){console.log("Error removing document: ",e)})),m();var t=p.collection("posts").doc(e.sender_email).collection("Sent").doc(C);t.get().then((function(e){1==e.data().to.length?(t.delete().then((function(){console.log("sender document deleted, everyone saw the pic")})).catch((function(e){console.log("Could not delete sender's document")})),f.ref("posts/".concat(C)).delete().then((function(e){console.log("Deleted from storage: ",C)})).catch((function(e){console.log("TRIED DELETING: ",C)})),p.collection("posts").doc(C).delete().then((function(){console.log("Deleted from firestore")})).catch((function(e){console.error("Error removing document: ",e)}))):console.log("working on it")}))},children:Object(v.jsx)("img",{className:"image",src:O})}):Object(v.jsxs)("li",{className:"message-content",onClick:function(){console.log("opening snap",e.user_email),p.collection("posts").doc(e.user_email).collection("Received").orderBy("timeStamp","desc").limit(1).get().then((function(e){e.forEach((function(e){e.empty?console.log("doc does not exist"):(c("New Snap"),_(e.data().imageURL),N(e.data().id))}))}))},children:[Object(v.jsx)("img",{className:"message-avatar",src:U,alt:"Avatar"}),Object(v.jsxs)("ul",{className:"message-info",children:[Object(v.jsx)("h3",{children:D}),Object(v.jsxs)("div",{className:"message-sub-info",children:[g,h,Object(v.jsx)("p",{children:Object(v.jsx)(w.a,{date:l,locale:"en-US"})}),e.streak_num>0?Object(v.jsxs)("p",{children:[e.streak_num,e.streak_image]}):null]})]})]})})}var S=function(e){Object(r.a)(s,e);var t=Object(d.a)(s);function s(e){var i;return Object(o.a)(this,s),(i=t.call(this,e)).login=function(){b.signInWithPopup(O).then((function(e){i.setState({user_name:e.user.displayName,user_email:e.user.email,user_pic:e.user.photoURL}),p.collection("users").doc(e.user.email).get().then((function(t){t.exists?i.get_friends_list():p.collection("users").doc(e.user.email).set({email:e.user.email,name:e.user.displayName,photoURL:e.user.photoURL,streak_emoji:i.state.streak_image,friends:[e.user.email]},i.get_friends_list()).catch((function(e){console.log("Couldn't write user to DB, error: ",e)}))})).catch((function(e){console.log("Error getting document:",e)}))})).catch((function(e){return console.log(e.message)}))},i.logout=function(){j.a.auth().signOut(),i.setState({user_name:"Guest",user_email:"Guest",user_friends:["Guest (Me)"],user_pic:"https://upload.wikimedia.org/wikipedia/commons/thumb/7/7e/Circle-icons-profile.svg/2048px-Circle-icons-profile.svg.png"})},i.get_friends_list=function(){p.collection("users").doc(i.state.user_email).get().then((function(e){i.setState({user_friends:e.data().friends})}))},i.state={streak_image:"\ud83d\udd25",user_name:"Guest",user_email:"Guest",user_friends:["Guest (Me)"],user_pic:"https://upload.wikimedia.org/wikipedia/commons/thumb/7/7e/Circle-icons-profile.svg/2048px-Circle-icons-profile.svg.png"},i}return Object(l.a)(s,[{key:"render",value:function(){var e=this,t=this.state.user_friends,s=0,i=[];for(s=0;s<t.length;s+=1)i[s]=t[s];return Object(v.jsxs)("div",{className:"messages-screen",children:[Object(v.jsxs)("div",{className:"navbar",children:[Object(v.jsx)("div",{className:"nav-box-1",children:Object(v.jsxs)("ul",{children:[Object(v.jsx)("li",{children:"Guest"==this.state.user_name?Object(v.jsx)("a",{onClick:this.login,children:"Sign In"}):Object(v.jsx)("img",{class:"profile-pic",src:this.state.user_pic,onClick:this.logout,alt:"Profile Picture"})}),Object(v.jsx)("li",{children:Object(v.jsx)("a",{children:"Search"})})]})}),Object(v.jsx)("div",{className:"nav-box-2",children:Object(v.jsx)("h1",{children:"Chat"})}),Object(v.jsx)("div",{className:"nav-box-3",children:Object(v.jsxs)("ul",{children:[Object(v.jsx)("li",{children:Object(v.jsx)("a",{children:"Add Friend"})}),Object(v.jsx)("li",{children:Object(v.jsx)("a",{children:"New Chat"})})]})})]}),Object(v.jsx)("ul",{className:"messages-list",children:i.map((function(t){return Object(v.jsx)(_,{sender_email:t,user_email:e.state.user_email,streak_image:e.state.streak_image})}))})]})}}]),s}(i.Component),k=s(47),C=s.n(k),N=s(107),y=(s(100),function(e){Object(r.a)(s,e);var t=Object(d.a)(s);function s(e){var i;return Object(o.a)(this,s),(i=t.call(this,e)).update=function(){i.setState({width:window.innerWidth,height:window.innerHeight,faceMode:"user"})},i.send=function(){var e=j.a.auth().currentUser,t=Object(N.a)(),s=e.email,n=e.displayName,c=[s];f.ref("posts/".concat(t)).putString(i.state.image,"data_url").on("state_changed",(function(e){}),(function(e){console.log(e)}),(function(){var e=0;for(e=0;e<c.length;e++){console.log(typeof c[e],c[e]);var a=c[e];f.ref("posts").child(t).getDownloadURL().then((function(e){p.collection("posts").doc(a).collection("Received").doc(t).set({imageURL:e,id:t,email:s,name:n,avatarURL:"https://upload.wikimedia.org/wikipedia/commons/thumb/7/7e/Circle-icons-profile.svg/2048px-Circle-icons-profile.svg.png",read:!1,timeStamp:j.a.firestore.FieldValue.serverTimestamp(),to:c}),console.log("Photo Sent"),i.setState({image:null})}))}p.collection("posts").doc(s).collection("Sent").doc(t).set({id:t,email:s,timeStamp:j.a.firestore.FieldValue.serverTimestamp(),to:c})}))},i.close=function(){i.setState({image:null})},i.capture=function(){var e=i.webcam.getScreenshot();i.setState({image:e})},i.setRef=function(e){i.webcam=e},i.state={width:window.innerWidth,height:window.innerHeight,image:null},window.addEventListener("resize",i.update),i}return Object(l.a)(s,[{key:"render",value:function(){return Object(v.jsxs)("div",{className:"cam-tab",children:[this.state.image?Object(v.jsx)("img",{src:this.state.image,alt:"asdf"}):Object(v.jsx)(C.a,{ref:this.setRef,videoConstraints:{facingMode:this.state.faceMode,width:this.state.width,height:this.state.height},screenshotFormat:"image/jpeg",audio:!1,mirrored:!0,className:"webcam"}),this.state.image?Object(v.jsx)("button",{className:"capture",onClick:this.close,children:"Close"}):Object(v.jsx)("button",{className:"capture",onClick:this.capture,children:"Capture"}),this.state.image?Object(v.jsx)("button",{className:"send",onClick:this.send,children:"Send"}):null]})}}]),s}(i.Component)),R=Object(g.bindKeyboard)(h.a),U=function(e){Object(r.a)(s,e);var t=Object(d.a)(s);function s(e){var i;return Object(o.a)(this,s),(i=t.call(this,e)).update=function(){i.setState({width:window.innerWidth,height:window.innerHeight})},i.state={index:0,height:window.innerHeight,width:window.innerWidth},window.addEventListener("resize",i.update),i}return Object(l.a)(s,[{key:"render",value:function(){return Object(v.jsxs)(R,{enableMouseEvents:!0,style:Object.assign({width:this.state.width,height:this.state.height,position:"absolute",top:"0%",left:"0%"}),children:[Object(v.jsxs)("div",{style:Object.assign({backgroundColor:"mediumseagreen",height:"100%",width:"100%"}),children:[Object(v.jsx)(u.a,{children:Object(v.jsx)("meta",{name:"viewport",content:"height=device-height, width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"})}),Object(v.jsx)(S,{})]}),Object(v.jsxs)("div",{style:Object.assign({backgroundColor:"Plum"}),children:[Object(v.jsx)(u.a,{children:Object(v.jsx)("meta",{name:"viewport",content:"height=device-height, width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes"})}),Object(v.jsx)(y,{})]})]})}}]),s}(n.a.Component);a.a.render(Object(v.jsx)(U,{}),document.getElementById("root"))},35:function(e,t,s){},93:function(e,t,s){}},[[101,1,2]]]);
//# sourceMappingURL=main.c612de7a.chunk.js.map